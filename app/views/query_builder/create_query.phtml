
public function <?= $this->function_name ?>($dbh<?
foreach ($this->variables as $one) {
    echo ', $' . $one;
}
?><? if ($this->pagination_function_enable): ?>,$pageNo,$pageSize<? endif ?>){

try {
$selectColumns =" SELECT ";
<?
foreach ($this->columns as $ind => $one) {
    echo '$selectColumns .="';
    if ($ind !== 0) {
        echo ", ";
    }

    if (empty($one['table_alias'])) {
        $columnName = '{$this->' . $one['table_varialbe'] . '}.' . $one['column_name'];
    } else {
        $columnName = "{$one['table_alias']}.{$one['column_name']}";
    }

    $aliasName = $one['alias_name'];
    echo "{$columnName} {$aliasName}\";\n";
}
?>
$queryBase=" FROM ";
<?
foreach ($this->frome_tables as $one) {
    echo '$queryBase.="';
    if (!empty($one['join_type'])) {
        echo $one['join_type'] . " ";
    }
    echo '{' . $one['table_variable'] . '}';

    if (!empty($one['table_alias'])) {
        echo " as {$one['table_alias']}";
    }

    if (!empty($one['logic_string'])) {
        echo " on {$one['logic_string']}";
    }

    echo "\";\n";
}


if (!empty($this->where_claus)) {
    echo '$queryBase.=" ' . "WHERE {$this->where_claus}\";\n";
}
?>

$bind_arr = array();

<?
foreach ($this->variables as $one) {
    echo '$bind_arr[\':' . $one . '\']=$' . $one . ";\n";
}
?>

<? if ($this->pagination_function_enable): ?>
    $stmt = $dbh->prepare("SELECT count(*) total ".$queryBase);

    $stmt_rv = $stmt->execute($bind_arr);

    if ($stmt_rv) {

    $total = intval($stmt->fetchColumn());

    $stmt->closeCursor();

    if ($pageSize <= 0) {
    $pageSize = 10;
    }

    if ($total === 0) {
    $totalPage = 0;
    } else {
    $totalPage = intval($total / $pageSize);

    if ($total % $pageNo !== 0) {
    $totalPage++;
    }
    }

    $re = array('total' => $total, 'total_pages' => $totalPage);
    if($pageNo<1){
    $pageNo=1;
    }
    $re['page_no']=$pageNo;

    $pageNo--;
    if($pageNo*$pageSize>$total){
    $re['data']=array();
    }
    else{
    $from=$pageNo*$pageSize;
    $stmt2= $dbh->prepare($selectColumns. $queryBase." limit {$from},{$pageSize}");
    $stmt_rv2 = $stmt2->execute($bind_arr);
    if($stmt_rv2){
    $re['data']=$stmt2->fetchAll();
    $re['fetch_size']=$stmt2->rowCount();
    }
    else{
    $re['data']=false;
    }
    }
    return $re;
    }
    else {
    return false;
    }
<? else: ?>

    $stmt = $dbh->prepare($selectColumns.$queryBase);

    $stmt_rv = $stmt->execute($bind_arr);

    if ($stmt_rv) {
    return $stmt->fetchAll();
    }
    else {
    return false;
    }
<? endif ?>
}
catch ( PDOException $x ) {
//$errorMessage="database error: " . $x->getMessage();
throw $x;
}
}
